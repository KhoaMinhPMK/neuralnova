<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Đăng ký - NeuralNova">
  <title>Đăng ký - NeuralNova</title>

  <link rel="stylesheet" href="../assets/css/reset.css">
  <link rel="stylesheet" href="../assets/css/variables.css">
  <link rel="stylesheet" href="../assets/css/base.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/layout.css">
  <link rel="stylesheet" href="../assets/css/responsive.css">

  <link rel="icon" type="image/x-icon" href="../assets/images/logo.ico">

  <style>
    :root { --login-bg: #0f0a1f; --login-panel: #1b1233; --login-input: #281b4f; --login-text: #e5e7eb; --login-muted: #a3a3a3; --login-primary: #7c3aed; --login-primary-2: #22d3ee; }
    body { background: var(--login-bg); }
    .auth-split { min-height: 100vh; display: grid; grid-template-columns: 1.2fr 1fr; }
    .auth-left { position: relative; overflow: hidden; display:flex; align-items:flex-end; }
    .auth-left::before { content:""; position:absolute; inset:0; background: url('../assets/images/Background Image.png') center/cover no-repeat; filter: saturate(110%); }
    .auth-left::after { content:""; position:absolute; inset:0; background: linear-gradient(90deg, rgba(15,10,31,.85), rgba(15,10,31,.35)); }
    .left-content { position:relative; color:#fff; padding: 6vh 6vw; }
    .left-slogan { font-size: clamp(1.4rem, 1.1rem + 1.2vw, 2.2rem); font-weight: 800; letter-spacing:.4px; }
    .left-slogan em { color: var(--login-primary-2); font-style: normal; }
    .auth-right { display:flex; align-items:center; justify-content:center; padding: 6vh 6vw; background: linear-gradient(180deg, rgba(27,18,51,.9), rgba(27,18,51,.9)); }
    .auth-card { width:100%; max-width: 460px; color: var(--login-text); }
    .brand { display:flex; align-items:center; gap:.6rem; color: var(--login-text); text-decoration:none; margin-bottom: 24px; }
    .brand img { width:28px; height:28px; }
    .auth-title { margin:0 0 8px; font-size: clamp(2rem, 1.5rem + 1.5vw, 2.6rem); font-weight: 800; color:#fff; }
    .auth-subtitle { color: var(--login-muted); margin-bottom: 18px; }
    .form-row { margin-bottom: 14px; }
    .form-label { display:block; margin-bottom: 6px; color: var(--login-muted); font-weight: 600; }
    .form-input { width: 100%; padding: 14px 14px; background: var(--login-input); border: 1px solid transparent; border-radius: 14px; color: var(--login-text); }
    .form-input::placeholder { color: #b7b7c3; }
    .form-input:focus { outline:none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139,92,246,.25); }
    .password-meter { height: 6px; background: #3b2a6b; border-radius: 999px; overflow: hidden; margin-top: .5rem; }
    .password-meter > span { display:block; height:100%; width:0; background:#ef4444; transition: width .25s ease, background-color .25s ease; }
    .terms { display:flex; align-items:flex-start; gap:.6rem; color: var(--login-muted); }
    .form-actions { margin-top: 16px; display:flex; flex-direction:column; gap:12px; }
    .btn-primary { width: 100%; padding: 14px 16px; background: linear-gradient(90deg, var(--login-primary), var(--login-primary-2)); color:#fff; border:none; border-radius: 16px; font-weight: 700; cursor:pointer; }
    .btn-primary:hover { filter: brightness(1.05); }
    .helper { text-align:center; color: var(--login-muted); }
    .toast { display:none; border-radius: 12px; padding:.75rem .9rem; font-size:.95rem; }
    .toast.success { display:block; background:#0f3d2e; color:#b7f7d0; border:1px solid #1c7a5b; }
    .toast.error { display:block; background:#3b0a0a; color:#fecaca; border:1px solid #7f1d1d; }
    @media (max-width: 900px) { .auth-split { grid-template-columns: 1fr; } .auth-left { min-height: 36vh; } }
    .error-text { color: #fecaca; font-size:.875rem; display:none; margin-top:.35rem; }
    .error .error-text { display:block; }
  </style>
</head>
<body>
  <main class="auth-split">
    <aside class="auth-left">
      <div class="left-content">
        <a class="brand" href="../index.html">
          <img src="../assets/images/logo.png" alt="NeuralNova">
          <strong style="letter-spacing:.3px; white-space:nowrap;">NeuralNova</strong>
        </a>
        <h2 class="left-slogan">JOIN YOUR <em>ADVENTURE!</em></h2>
      </div>
    </aside>
    <section class="auth-right">
      <div class="auth-card" aria-labelledby="auth-title">
        <header class="auth-header">
          <h1 id="auth-title" class="auth-title">SIGN UP</h1>
          <p class="auth-subtitle">Create an account to get started</p>
        </header>

        <div id="registerToast" class="toast" role="alert" aria-live="polite"></div>

        <form id="registerForm" novalidate>
          <div class="form-row" id="row-fullname">
            <label class="form-label" for="fullName">Họ và tên</label>
            <input class="form-input" type="text" id="fullName" name="fullName" placeholder="Nguyễn Văn A" autocomplete="name" required aria-required="true" />
            <div class="error-text" id="error-fullname">Vui lòng nhập họ tên (tối thiểu 2 ký tự).</div>
          </div>

          <div class="form-row" id="row-email">
            <label class="form-label" for="email">Email</label>
            <input class="form-input" type="email" id="email" name="email" placeholder="yourname@gmail.com" autocomplete="email" required aria-required="true" />
            <div class="error-text" id="error-email">Email không hợp lệ.</div>
          </div>

          <div class="form-row" id="row-password">
            <label class="form-label" for="password">Mật khẩu</label>
            <input class="form-input" type="password" id="password" name="password" placeholder="Tối thiểu 8 ký tự" autocomplete="new-password" required aria-required="true" />
            <div class="password-meter" aria-hidden="true"><span id="pw-meter-bar"></span></div>
            <div class="error-text" id="error-password">Mật khẩu chưa đủ mạnh.</div>
          </div>

          <div class="form-row" id="row-confirm">
            <label class="form-label" for="confirmPassword">Xác nhận mật khẩu</label>
            <input class="form-input" type="password" id="confirmPassword" name="confirmPassword" placeholder="Nhập lại mật khẩu" autocomplete="new-password" required aria-required="true" />
            <div class="error-text" id="error-confirm">Mật khẩu xác nhận không khớp.</div>
          </div>

          <div class="form-row">
            <label class="terms">
              <input type="checkbox" id="terms" name="terms" required aria-required="true" />
              <span>Tôi đồng ý với Điều khoản và Chính sách bảo mật.</span>
            </label>
            <div class="error-text" id="error-terms">Bạn cần đồng ý điều khoản để tiếp tục.</div>
          </div>

          <div class="form-actions">
            <button id="btnSubmitRegister" class="btn-primary" type="submit">Tạo tài khoản</button>
            <p class="helper">Đã có tài khoản? <a href="./login.html">Đăng nhập</a></p>
          </div>
        </form>
      </div>
    </section>
  </main>

  <script type="module">
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
    const el = (sel) => document.querySelector(sel);
    const showToast = (msg, type = 'success') => { const t = el('#registerToast'); t.className = `toast ${type}`; t.textContent = msg; };

    const calcPasswordStrength = (pw) => {
      let score = 0;
      if (pw.length >= 8) score++;
      if (/[a-z]/.test(pw)) score++;
      if (/[A-Z]/.test(pw)) score++;
      if (/[0-9]/.test(pw)) score++;
      if (/[^A-Za-z0-9]/.test(pw)) score++;
      return Math.min(score, 5);
    };
    const updateMeter = (score) => {
      const bar = el('#pw-meter-bar');
      const widths = ['0%','20%','40%','60%','80%','100%'];
      const colors = ['#ef4444','#f97316','#f59e0b','#10b981','#22c55e','#16a34a'];
      bar.style.width = widths[score];
      bar.style.background = colors[score];
    };

    const saveDraft = () => {
      const fullName = el('#fullName').value.trim();
      const email = el('#email').value.trim();
      localStorage.setItem('registerDraft', JSON.stringify({ fullName, email }));
    };
    const loadDraft = () => {
      try {
        const raw = localStorage.getItem('registerDraft');
        if (!raw) return;
        const { fullName, email } = JSON.parse(raw);
        if (fullName) el('#fullName').value = fullName;
        if (email) el('#email').value = email;
      } catch {}
    };

    const setRowError = (rowId, hasError) => {
      const row = document.getElementById(rowId);
      row.classList.toggle('error', hasError);
      const input = row.querySelector('.form-input');
      if (input) input.setAttribute('aria-invalid', hasError ? 'true' : 'false');
    };

    const validate = () => {
      const fullName = el('#fullName').value.trim();
      const email = el('#email').value.trim();
      const password = el('#password').value;
      const confirm = el('#confirmPassword').value;
      const terms = el('#terms').checked;

      let ok = true;
      const nameOk = fullName.length >= 2; setRowError('row-fullname', !nameOk); ok = ok && nameOk;
      const emailOk = emailRegex.test(email); setRowError('row-email', !emailOk); ok = ok && emailOk;
      const pwScore = calcPasswordStrength(password); updateMeter(pwScore); const pwOk = pwScore >= 3; setRowError('row-password', !pwOk); ok = ok && pwOk;
      const cfOk = password.length > 0 && password === confirm; setRowError('row-confirm', !cfOk); ok = ok && cfOk;
      const termsErr = el('#error-terms'); if (termsErr) termsErr.style.display = terms ? 'none' : 'block'; ok = ok && terms;
      return ok;
    };

    const simulateRegister = (data) => new Promise((resolve, reject) => {
      setTimeout(() => { String(data.email).toLowerCase().includes('fail') ? reject(new Error('Email đã tồn tại')) : resolve({ userId: Math.random().toString(36).slice(2) }); }, 900);
    });

    document.addEventListener('DOMContentLoaded', () => {
      loadDraft();
      const form = document.getElementById('registerForm');
      const btn = document.getElementById('btnSubmitRegister');

      form.addEventListener('input', (e) => {
        if (e.target && e.target.id === 'password') updateMeter(calcPasswordStrength(e.target.value));
        validate();
        saveDraft();
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        showToast('', '');
        if (!validate()) { showToast('Vui lòng kiểm tra lại các trường thông tin.', 'error'); return; }

        const payload = { fullName: el('#fullName').value.trim(), email: el('#email').value.trim() };
        const original = btn.textContent; btn.textContent = 'Đang tạo tài khoản...'; btn.disabled = true;
        try {
          await simulateRegister(payload);
          localStorage.removeItem('registerDraft');
          showToast('Tạo tài khoản thành công! Bạn có thể đăng nhập.', 'success');
          form.reset(); updateMeter(0);
        } catch (err) {
          showToast(err.message || 'Có lỗi xảy ra. Vui lòng thử lại.', 'error');
        } finally {
          btn.textContent = original; btn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>

