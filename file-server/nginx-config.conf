# Nginx Configuration for NeuralNova File Server
# Add this to your existing Nginx site config

# File upload endpoints - proxy to Node.js server
location /fileserver/ {
    # Remove /fileserver prefix and forward to Node.js
    rewrite ^/fileserver/(.*) /$1 break;
    
    # Proxy to Node.js server on port 3000
    proxy_pass http://localhost:3000;
    
    # Headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Upload size limits
    client_max_body_size 100M;
    client_body_buffer_size 128k;
    
    # Timeouts for large uploads
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
    
    # Disable buffering for large uploads
    proxy_request_buffering off;
    proxy_buffering off;
}

# Static file serving (uploaded files)
location /uploads/ {
    # Proxy to Node.js server
    proxy_pass http://localhost:3000/uploads/;
    
    # Cache headers for static files
    expires 1y;
    add_header Cache-Control "public, immutable";
    
    # CORS headers
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, OPTIONS";
}

